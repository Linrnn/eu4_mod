sub_province_development_with_tag = {
	sub_province_development = { peek_value = 20 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 19 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 18 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 17 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 16 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 15 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 14 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 13 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 12 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 11 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 10 flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 9  flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 8  flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 7  flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 6  flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 5  flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 4  flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 3  flag_value = $with_tag_value$ }
	sub_province_development = { peek_value = 2  flag_value = $with_tag_value$ }
	clr_province_flag = $with_tag_value$
}

sub_province_development = {
	if = {
		limit = {
			NOT = {
				has_province_flag = $flag_value$
			}
		}

		if = {
			limit = {
				base_tax = $peek_value$
			}
			add_base_tax = -1
			set_province_flag = $flag_value$
		}
		else_if = {
			limit = {
				base_production = $peek_value$
			}
			add_base_production = -1
			set_province_flag = $flag_value$
		}
		else_if = {
			limit = {
				base_manpower = $peek_value$
			}
			add_base_manpower = -1
			set_province_flag = $flag_value$
		}
	}
}

try_add_country_modifier = {
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				NOT = {
					has_country_modifier = $modifier_value$
				}
			}
			add_country_modifier = {
				name = $modifier_value$
				duration = $duration_value$		# -1:无限时间
			}
		}
	}
}

try_remove_country_modifier = {
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				has_country_modifier = $modifier_value$
			}
			remove_country_modifier = $modifier_value$
		}
	}
}

try_add_all_province_modifier = {
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
			}
			every_owned_province = {
				if = {
					limit = {
						NOT = {
							has_province_modifier = $modifier_value$
						}
					}
					add_province_modifier = {
						name = $modifier_value$
						duration = $duration_value$		# -1:无限时间
					}
				}
			}
		}
	}
}

try_remove_all_province_modifier = {
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
			}
			every_owned_province = {
				if = {
					limit = {
						has_province_modifier = $modifier_value$
					}
					remove_province_modifier = $modifier_value$
				}
			}
		}
	}
}

remove_fake_province = {							# 虚空省份
	$tag_value$ = {
		every_owned_province = {
			if = {
				limit = {
					NOT = {
						range = $tag_value$
					}
				}
				decolonize = yes					# 殖民地
			}
		}
	}
}

try_create_guarantee = {							# 保障独立
	$main_tag$ = {
		if = {
			limit = {
				exists = yes
				exists = $subject_tag$
				NOT = {
					has_guaranteed = $subject_tag$	# 已经保证独立
				}
			}
			create_guarantee = $subject_tag$		# 给予保障独立的国家
		}
	}
}

alloc_permanent_claim = {							# 永久宣称
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				$range_value$ = {
					NOT = {
						owned_by = $tag_value$
						is_permanent_claim = $tag_value$	# 是永久宣称
					}
				}
			}
			$range_value$ = {
				add_permanent_claim = $tag_value$			# 获得永久性宣称的国家
			}
		}
	}
}

alloc_release = {
	$range_value$ = {
		if = {
			limit = {
				is_core = $tag_value$
				NOT = {
					exists = $tag_value$
				}
			}
			owner = {
				release = $tag_value$
			}
		}
	}
}

alloc_tag = {
	if = {
		limit = {
			exists = $cur_tag$
			NOT = {
				exists = $new_tag$
			}
		}
		$cur_tag$ = {
			change_tag = $new_tag$	# 变更控制的TAG
		}
	}
}

alloc_colonial_province = {
	$range_value$ = {
		if = {
			limit = {
				exists = yes
				NOT = {
					owned_by = $tag_value$
				}
			}
			cede_province = $tag_value$
		}
	}
}

alloc_province = {
	$range_value$ = {
		if = {
			limit = {
				exists = $tag_value$
				NOT = {
					owned_by = $tag_value$
				}
			}
			if = {
				limit = {
					NOT = {
						is_core = $tag_value$
					}
				}
				add_core = $tag_value$
			}
			cede_province = $tag_value$
		}
	}
}

force_alloc_province = {
	$range_value$ = {
		if = {
			limit = {
				NOT = {
					owned_by = $tag_value$
				}
			}
			if = {
				limit = {
					NOT = {
						is_core = $tag_value$
					}
				}
				add_core = $tag_value$
			}
			cede_province = $tag_value$
		}
	}
}

alloc_capital = {
	alloc_province = {
		range_value = $province_value$
		tag_value = $tag_value$
	}
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				NOT = {
					capital = $province_value$
				}
			}
			set_capital = $province_value$
			# $province_value$ = {
			# 	move_capital_effect = yes
			# }
		}
	}
}

force_alloc_capital = {
	force_alloc_province = {
		range_value = $province_value$
		tag_value = $tag_value$
	}
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				NOT = {
					capital = $province_value$
				}
			}
			set_capital = $province_value$
			# $province_value$ = {
			# 	move_capital_effect = yes
			# }
		}
	}
}

alloc_emperor = {									# 神罗皇帝
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				is_emperor = no
			}
			set_emperor = yes
		}
	}
}

alloc_elector = {									# 神罗帝选侯
	if = {
		limit = {
			NOT = {
				num_of_electors = 7
			}
		}
		$tag_value$ = {
			if = {
				limit = {
					exists = yes
					is_part_of_hre = yes
					is_elector = no
				}
				elector = yes
			}
		}
	}
}

cancel_all_elector = {
	every_elector = {
		if = {
			limit = {
				NOT = {
					tag = $tag_hold$
				}
			}
			elector = no
		}
	}
}

alloc_emperor_of_china = {							# 中华帝国
	if = {
		limit = {
			$tag_value$ = {
				exists = yes
				is_emperor_of_china = no	# 是中国皇帝
			}
		}
		dismantle_empire_of_china = no
		set_emperor_of_china = $tag_value$
	}
}

alloc_tributary = {									# 朝贡国
	$main_tag$ = {
		if = {
			limit = {
				exists = yes
				is_subject = no						# 是附属国
				$subject_tag$ = {
					exists = yes
					NOT = {
						is_subject_of = $main_tag$	# 是某国的属国
					}
				}
			}
			create_subject = {
    			subject_type = tributary_state
    			subject = $subject_tag$
			}
		}
	}
}

alloc_march = {										# 卫戍国
	$main_tag$ = {
		if = {
			limit = {
				exists = yes
				is_subject = no
				$subject_tag$ = {
					exists = yes
					NOT = {
						march_of = $main_tag$
					}
				}
			}
			create_march = $subject_tag$
		}
	}
}

alloc_country_province_religion = {					# 宗教
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				is_religion_enabled = $religion_value$
			}
			if = {
				limit = {
					NOT = {
						religion = $religion_value$
					}
				}
				change_religion = $religion_value$
				force_converted = yes
			}
			alloc_role_religion = {
				religion_value = $religion_value$
			}
			every_owned_province = {
				if = {
					limit = {
						has_owner_religion = no
					}
					change_religion = $religion_value$
				}
			}
		}
	}
}

alloc_country_religion = {							# 宗教
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				is_religion_enabled = $religion_value$
			}
			if = {
				limit = {
					NOT = {
						religion = $religion_value$
					}
				}
				change_religion = $religion_value$
				force_converted = yes
			}
			alloc_role_religion = {
				religion_value = $religion_value$
			}
		}
	}
}

alloc_province_religion = {							# 宗教
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				is_religion_enabled = $religion_value$
			}
			every_owned_province = {
				if = {
					limit = {
						NOT = {
							religion = $religion_value$
						}
					}
					change_religion = $religion_value$
				}
			}
		}
	}
}

alloc_harmonized_religion_group = {					# 宗教和谐
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				is_religion_enabled = $religion_value$
			}
			if = {
				limit = {
					NOT = {
						religion = $religion_value$
						has_harmonized_with = $religion_group_value$
					}
				}
				add_harmonized_religion = $religion_value$
			}
		}
	}
}

alloc_harmonized_religion = {						# 宗教和谐
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				is_religion_enabled = $religion_value$
			}
			if = {
				limit = {
					NOT = {
						religion = $religion_value$
						has_harmonized_with = $religion_value$
					}
				}
				add_harmonized_religion = $religion_value$
			}
		}
	}
}

save_province_religion = {
	# $tag_value$ = {
	# 	if = {
	# 		limit = {
	# 			exists = yes
	# 		}
	# 		every_owned_province = {
	# 			export_to_variable = {
	# 				which = my_province_religion
	# 				value = religion
	# 			}
	# 		}
	# 	}
	# }
	if = {
		limit = {
			NOT = {
				religion = 0
			}
		}
		$range_value$ = {
			export_to_variable = {
				which = my_province_religion
				value = religion
			}
		}
	}
}

load_province_religion = {
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
			}
			every_owned_province = {
				if = {
					limit = {
						NOT = {
							religion = variable:my_province_religion
						}
					}
					change_religion = variable:my_province_religion
				}
			}
		}
	}
}

alloc_government_rank = {							# 政府等级
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				is_free_or_tributary_trigger = yes
				NOT = {
					government_rank = $rank_value$
				}
			}
			set_government_rank = $rank_value$
		}
	}
}

alloc_country_province_culture = {					# 主流文化
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
			}
			if = {
				limit = {
					NOT = {
						primary_culture = $culture_value$
					}
				}
				change_primary_culture = $culture_value$
			}
			alloc_role_culture = {
				culture_value = $culture_value$
			}
			every_owned_province = {
				if = {
					limit = {
						NOT = {
							culture = $culture_value$
						}
					}
					change_culture = $culture_value$
				}
			}
		}
	}
}

alloc_country_culture = {							# 主流文化
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
			}
			if = {
				limit = {
					NOT = {
						primary_culture = $culture_value$
					}
				}
				change_primary_culture = $culture_value$
			}
			alloc_role_culture = {
				culture_value = $culture_value$
			}
		}
	}
}

alloc_province_culture = {							# 主流文化
	$range_value$ = {
		if = {
			limit = {
				NOT = {
					culture = $culture_value$
				}
			}
			change_culture = $culture_value$
		}
	}
}

set_province_development = {						# 发展度
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
			}
			every_owned_province = {
				if = {
					limit = {
						base_tax = 2
					}
					set_base_tax = 1
				}
				if = {
					limit = {
						base_production = 2
					}
					set_base_production = 1
				}
				if = {
					limit = {
						base_manpower = 2
					}
					set_base_manpower = 1
				}
			}
		}
	}
}

alloc_role_religion = {
	if = {
		limit = {
			NOT = {
				ruler_religion = $religion_value$
			}
		}
		set_ruler_religion = $religion_value$
	}
	if = {
		limit = {
			has_heir = yes
			NOT = {
				heir_religion = $religion_value$
			}
		}
		set_heir_religion = $religion_value$
	}
}

alloc_role_culture = {
	if = {
		limit = {
			NOT = {
				ruler_culture = $culture_value$
			}
		}
		set_ruler_culture = $culture_value$
	}
	if = {
		limit = {
			has_heir = yes
			NOT = {
				heir_culture = $culture_value$
			}
		}
		set_heir_culture = $culture_value$
	}
}

alloc_papal_controller = {							# 教监
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				religion = catholic
				ruler_religion = catholic
				is_papal_controller = no
			}
			transfer_papal_controller = $tag_value$
		}
	}
}

alloc_my_defender_of_faith = {						# 信仰守护者
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				religion = $religion_value$
				ruler_religion = $religion_value$
				is_defender_of_faith = no
			}
			set_defender_of_the_faith = {
				who = $tag_value$
				religion = $religion_value$
			}
			add_treasury = -500
		}
	}
}

alloc_casus_belli = {								# 战争借口
	$main_tag$ = {
		if = {
			limit = {
				exists = yes
				is_subject = no
				# NOI = {
				# 	has_casus_belli = {
				# 		type = $cb_value$
				# 		target = $target_tag$
				# 	}
				# }
			}
			add_casus_belli = {
				type = $cb_value$
				target = $target_tag$
				month = $duration_value$
			}
		}
	}
}

try_remove_building = {								# 移除建筑
	if = {
		limit = {
			has_building = $building_value$
		}
		remove_building = $building_value$
	}
}

building_sub_fort_level = {
	if = {
		limit = {
			has_building = fort_18th
		}
		remove_building = fort_18th
		add_building = fort_17th
	}
	else_if = {
		limit = {
			has_building = fort_17th
		}
		remove_building = fort_17th
		add_building = fort_16th
	}
	else_if = {
		limit = {
			has_building = fort_16th
		}
		remove_building = fort_16th
		add_building = fort_15th
	}
}

building_remove_fort = {
	try_remove_building = { building_value = fort_15th }
	try_remove_building = { building_value = fort_16th }
	try_remove_building = { building_value = fort_17th }
	try_remove_building = { building_value = fort_18th }
}

remove_all_building = {
	try_remove_building = { building_value = marketplace }
	try_remove_building = { building_value = workshop }
	try_remove_building = { building_value = temple }
	try_remove_building = { building_value = barracks }
	try_remove_building = { building_value = shipyard }
	# try_remove_building = { building_value = fort_15th }
	try_remove_building = { building_value = coastal_defence }
	try_remove_building = { building_value = courthouse }
	try_remove_building = { building_value = dock }
	try_remove_building = { building_value = regimental_camp }
	# try_remove_building = { building_value = fort_16th }
	try_remove_building = { building_value = naval_battery }
	try_remove_building = { building_value = cathedral }
	try_remove_building = { building_value = university }
	try_remove_building = { building_value = trade_depot }
	try_remove_building = { building_value = grand_shipyard }
	try_remove_building = { building_value = training_fields }
	# try_remove_building = { building_value = fort_17th }
	try_remove_building = { building_value = stock_exchange }
	try_remove_building = { building_value = counting_house }
	try_remove_building = { building_value = town_hall }
	try_remove_building = { building_value = drydock }
	try_remove_building = { building_value = conscription_center }
	# try_remove_building = { building_value = fort_18th }
	# manufactory
	try_remove_building = { building_value = wharf }
	try_remove_building = { building_value = weapons }
	try_remove_building = { building_value = textile }
	try_remove_building = { building_value = plantations }
	try_remove_building = { building_value = tradecompany }
	try_remove_building = { building_value = farm_estate }
	try_remove_building = { building_value = mills }
	try_remove_building = { building_value = furnace }
	try_remove_building = { building_value = ramparts }
	try_remove_building = { building_value = soldier_households }
	try_remove_building = { building_value = impressment_offices }
	try_remove_building = { building_value = state_house }
	# native building
	try_remove_building = { building_value = native_earthwork }
	try_remove_building = { building_value = native_palisade }
	try_remove_building = { building_value = native_fortified_house }
	try_remove_building = { building_value = native_ceremonial_fire_pit }
	try_remove_building = { building_value = native_irrigation }

	try_remove_building = { building_value = native_storehouse }
	try_remove_building = { building_value = native_longhouse }
	try_remove_building = { building_value = native_sweat_lodge }
	try_remove_building = { building_value = native_great_trail }

	# 伏尔泰的噩梦
	# building
	try_remove_building = { building_value = fort_14th }
	try_remove_building = { building_value = road_network }
	try_remove_building = { building_value = post_office }
	try_remove_building = { building_value = harbour }
	try_remove_building = { building_value = armory }
	try_remove_building = { building_value = college }
	try_remove_building = { building_value = customs_house }
	try_remove_building = { building_value = arsenal }
	try_remove_building = { building_value = monument }
	try_remove_building = { building_value = artisan }
	try_remove_building = { building_value = watchman }
	# native building
	try_remove_building = { building_value = native_three_sisters_field }
}

remove_all_province_building = {
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
			}
			every_owned_province = {
				building_remove_fort = { }
				remove_all_building = { }
			}
		}
	}
}

try_crushing_revolution = {
	$tag_value$ = {
		if = {
			limit = {
				exists = yes
				is_revolutionary = yes
				OR = {
					has_reform = junior_revolutionary_republic_reform
					has_reform = revolutionary_empire_reform
				}
			}

			add_government_reform = noble_elite_reform
			# add_government_reform = parliamentary_reform
			# add_republican_tradition = 100

			# add_government_reform = revolutionary_empire_reform
			# add_government_reform = autocracy_reform
			# add_legitimacy = 100
		}
	}
}
